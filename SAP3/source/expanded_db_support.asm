	ORG	0
start:	JMP Test

;
;************************************************************
;           MESSAGE TABLE FOR OPERATIONAL CPU TEST
;************************************************************
;
OKCPU:	DB	0CH,0DH,0AH,'CPU IS OPERATIONAL$'
;
NGCPU:	DB	0CH,0DH,0AH,'CPU HAS FAILED!    ERROR EXIT=$'
;
;


Test:	LXI HL, OKCPU
	CALL MSGOUT
	CALL LINE
	HLT

CPUER:	LXI	HL,NGCPU	;OUTPUT "CPU HAS FAILED    ERROR EXIT=" TO CONSOLE
	CALL	MSGOUT
	XTHL
	MOV	A,H
	CALL	BYTEO	;SHOW ERROR EXIT ADDRESS HIGH BYTE
	MOV	A,L
	CALL	BYTEO	;SHOW ERROR EXIT ADDRESS LOW BYTE
	CALL LINE
	HLT
;
;
;
CPUOK:	LXI	HL,OKCPU	;OUTPUT "CPU IS OPERATIONAL" TO CONSOLE
	CALL	MSGOUT
	CALL LINE
	HLT
;
MSGOUT:	PUSH HL
LOOP:	MOV A,M
	CPI '$'
	JZ DONE
	OUT 5
	INX HL
	JMP LOOP

DONE:	POP HL
	RET

LINE:	PUSH PSW;
	XRA A
	OUT 6
	POP PSW
	RET

PCHAR:	OUT 5
	RET

BYTEO:	PUSH	PSW
	CALL	BYTO1
	CALL	PCHAR
	POP	PSW
	CALL	BYTO2
	JMP	PCHAR
BYTO1:	RRC
	RRC
	RRC
	RRC
BYTO2:	ANI	0FH
	CPI	0AH
	JM	BYTO3
	ADI	7
BYTO3:	ADI	30H
	RET
	END
